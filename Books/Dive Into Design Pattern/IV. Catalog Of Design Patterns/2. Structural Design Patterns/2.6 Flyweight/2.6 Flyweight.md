
# Concept

***Flyweight is a structural design pattern that lets you fit more objects into the available amount of RAM by sharing common parts of state between multiple objects instead of keeping all of the data in each object***

- Flyweight là một mẫu thiết kế cấu trúc được sử dụng để tối ưu hóa việc sử dụng bộ nhớ(RAM) bằng cách chia sẽ các phần chung của `state` giữa các objects với nhau thay vì giữ tất cả `data` trong mỗi object

# Problem

- Tạo một simple video game bắn súng:
	- Kiểu như PUBG
	- Apply hệ thống hạt (particle system) thực tế để biến nó thành một feature đặc biệt
		- Particle system trong trò chơi dùng để tạo các hiệu ứng hình ảnh động cho các sự kiện như súng đạn, tên lửa, ...
	- Một lượng lớn đạn, tên lửa và mảnh đạn từ các vụ nổ sẽ bay khắp bản đồ và mang đến trải nghiệm ly kỳ cho player
- Sau khi game hoàn thành, bạn built game & gửi cho bạn bè cùng chơi
	- Tuy nhiên, khi họ chơi được vài phút thì lại bị crashing mặc dù máy bạn chơi vẫn ổn
- Lỗi xảy ra do máy thiếu RAM, và do máy bạn cấu hình mạnh hơn máy của your friend nên chưa bị sao

![[oop-106.png]]

- Vấn đề thực tế liên quan đến particle system 
	- Mỗi particle, chẳng hạn như một viên đạn, một tên lửa hoặc một mảnh đạn được represented bới một vật thể riêng biệt chứa nhiều data
	- Khi đến khúc combat cao trào thì các particle mới được tạo ra vượt quá với RAM còn lại, nên game bị cashed

# Solution

- Khi check lại `Particle` class, bạn nhận thấy các fields `color` & `sprite` tiêu tốn nhiều memory hơn các fields khác
	- Cay hơn là 2 fields này lưu trữ data gần như giống hệt nhau trên tất cả các particles
	- Ex: tất cả các viên đạn có cùng color & sprite
	
![[oop-107.png]]

- Các phần khác của particle's state, chẳng hạn như coordinates, movement vevtor & speed là unique cho mỗi particle
	- Value của các fields này thay đổi theo thời gian trong khi color & sprite không đổi cho mỗi particle

- Constant data của một object called `intrinsic state`, nằm trong object & only read , không thể change
- Phần còn lại của state thường bị change bởi các object khác, called `extrinsic state`
- Khi apply flyweight pattern, `intrinsic state` sẽ được giữ lại bên trong objects, trong khi `extrinsic state` sẽ được truyền từ bên ngoài thông qua các methods cụ thể...
- Điều này giúp tối ưu hóa memory bằng cách chỉ lưu constant data 1 lần duy nhất & reuse trong các context khác nhau

![[oop-108.png]]




	



