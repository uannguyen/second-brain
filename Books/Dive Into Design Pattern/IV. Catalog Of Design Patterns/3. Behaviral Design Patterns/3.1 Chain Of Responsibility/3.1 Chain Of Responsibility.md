![[oop-128.png]]

# Concept

***Chain of Responsibility is a behavioral design pattern that lets you pass requests along a chain of handlers. Upon receiving a request, each handler decides either to process the request or to pass it to the next handler in the chain***

- Là mẫu thiết kế hành vi cho phép truyền requests dọc theo một chuỗi handlers
	- Khi nhận được một request, mỗi handler quyết định xử lý request đó hoặc truyền nó đến handler kế tiếp trong chuỗi

# Problem

- Giả sử một hệ thống đặt hàng online: 
	- User đã xác thực mới được create order 
	- Admin có full quyền truy cập vào all orders 
- Những kiểm tra này phải được làm tuần tự
- Application sẽ xác thực user và nếu invalid thì nó sẽ trả thông báo về không tiến hành bất kỳ kiểm tra nào khác

![[oop-129.png]]

- Phát sinh một số vấn đề:
	- Không an khi pass raw data thẳng đến ordering system
	 => Add extra validation step
	
	- Dễ bị force password cracking
	 => Add filters để check các failed request lặp đi lặp lại trong cùng một IP address
		
	- Speed up system bằng cách cache response cho các request lặp đi lặp lại chứa cùng một data
	 => Add check chỉ cho phép request pass to the system khi không có cache response phù hợp
	
	![[oop-130.png]]

- Khó khăn:
	- Code sẽ ngày càng cồng kềnh lộn xộn hơn khi thêm các tính năng checks mới
	- Thay đổi một phần kiểm tra có thể ảnh hưởng đến những phần khác
	- Khó reuse các phần checks này cho các thành phần khác của system 
	
=> Code trở nên khó hiểu, tốn kém khi maintain 

# Solution

- **Chain of Responsibility** pattern dựa vào việc transforming các behaviors cụ thể  thành các objects độc lập called *handlers*
	- Ở Ex trên, mỗi phần check nên được trích xuất vào own class của nó với single method thực hiện việc check
	- Request cùng input data được truyền tới method này như một argument 
	
- Pattern gợi ý liên kết các handlers thành một chain
	- Mỗi handler được liên kết có một field lưu trữ reference đến next handler trong chain
	- Ngoài việc xử lý request, handlers còn pass request đi xa hơn dọc theo chain
	- Request đi dọc theo chain cho đến khi tất cả handlers đã xử lý nó
	
- Một handler có thể quyết định không pass request và ngăn chặn bất kỳ quá trình xử lý nào	

- Với ordering system, một handler thực hiện quá trình xử lý & quyết định có nên pass request sang các handler nằm ở phía sau(trong cùng chain) hay không

![[oop-131.png]]
		
 - Có một cách tiếp cận kinh điển khác:
	- Chỉ có một handler duy nhất xử lý request: Khi nhận một request, handler quyết định xem có thể xử lý nó không, nếu có thì handler này sẽ xử lý và không pass request sang các handlers khác
	- Phổ biến khi xử lý các events in stacks của elements với một graphical user interface
	- Ex: 
	

![[oop-132.png]]
































